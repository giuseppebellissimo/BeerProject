{% load static %}
{% load crispy_forms_filters %}

{% block content %}
    {% spaceless %}
        {% if user.is_authenticated %}
            <form method="post" id="step-form" action="{% url 'add-step-recipe' recipe_id %}">
                <h3>Recipe Steps</h3>
                <table class="table table-striped">
                    {% csrf_token %}
                    {{ step_form.management_form }}
                    {% for form in step_form.forms %}
                        {% if forloop.first %}
                            <thead>
                            <tr>
                                {% for field in form.visible_fields %}
                                    <th>{{ field.label|capfirst }}</th>
                                {% endfor %}
                            </tr>
                            </thead>
                        {% endif %}
                        <tr class="{% cycle 'row1' 'row2' %} step_formset_row">
                            {% for field in form.visible_fields %}
                                <td>
                                    {% if forloop.first %}
                                        {% for hidden in form.hidden_fields %}
                                            {{ hidden }}
                                        {% endfor %}
                                    {% endif %}
                                    {{ field.errors.as_ul }}
                                    {{ field }}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </table>
                <button class="btn btn-outline-success" type="submit" id="saveStepButton"
                        style="margin-bottom: 15px">Save Step
                </button>
            </form>
        {% endif %}

        <script src="{% static 'formset/jquery_formset.js' %}"></script>
        <script type="text/javascript">
            $('.step_formset_row').formset({
                prefix: 'property',
                addText: 'Add',
                deleteText: 'Delete',
                formCssClass: 'dynamic-formset1',
                addCssClass: 'add-row btn btn-primary',
                deleteCssClass: 'delete-row btn btn-danger',
            });

            $('#saveStepButton').on('click',function () {
                const form_data = new FormData();

                form_data.append('name',document.getElementById('id_name').value);
                form_data.append('litre',document.getElementById('id_litre').value);
                form_data.append('ebc',document.getElementById('id_ebc').value);
                form_data.append('ibu',document.getElementById('id_ibu').value);
            })
        </script>
    {% endspaceless %}
{% endblock %}